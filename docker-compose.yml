services:
  accordserver:
    build: .
    ports:
      - "39099:39099"
    volumes:
      - accord-data:/app/data
      - ./cdn:/app/cdn
    environment:
      PORT: 39099
      DATABASE_URL: sqlite:/app/data/accord.db?mode=rwc
      RUST_LOG: accordserver=debug,tower_http=debug
      LIVEKIT_URL: http://livekit:7880
      LIVEKIT_API_KEY: devkey
      LIVEKIT_API_SECRET: secret
      ACCORD_VOICE_BACKEND: livekit
    depends_on:
      - livekit

  livekit:
    image: livekit/livekit-server:latest
    command: --dev --keys '{"devkey": "secret"}'
    ports:
      - "7880:7880"
      - "7881:7881"
      - "7882:7882/udp"
    environment:
      LIVEKIT_KEYS: '{"devkey": "secret"}'

volumes:
  accord-data:
